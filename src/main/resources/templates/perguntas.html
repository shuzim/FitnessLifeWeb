<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perguntas - Preferências Alimentares</title>

  <!-- Bootstrap e Ícones -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">


  <style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f6f9fc;
        color: #333;
        margin: 0;
        padding: 20px;
    }

    /* Apenas o h1 ganha espaço extra para não ser coberto pela navbar */
    h1 {
        color: #2b6cb0;
        margin-top: 90px; /* Ajusta a distância da navbar */
    }

    #resposta {
        background-color: #fff;
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        white-space: pre-wrap;
    }

    button {
        background-color: #2b6cb0;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        margin-top: 15px;
    }

    button:hover {
        background-color: #2c5282;
    }

    .navbar {
        background: linear-gradient(90deg, #007bff, #00c4ff);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .navbar-brand, .nav-link {
        color: white !important;
        font-weight: 600;
        font-family: 'Poppins', sans-serif;
    }

    .navbar-brand:hover, .nav-link:hover {
        color: #f8f9fa !important;
    }
  </style>

</head>
<body class="bg-light">

<!-- Navbar -->
<nav class="navbar navbar-expand-lg fixed-top">
  <div class="container">
    <a class="navbar-brand" href="/menu">FitnessLife</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link" href="/menu"><i class="bi bi-house-door me-1"></i>Menu</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/perfilnutricional"><i class="bi bi-person-circle me-1"></i>Perfil</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/menu"><i class="bi bi-box-arrow-right me-1"></i>Sair</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container mt-5">
  <div class="card shadow p-4">
    <h2 class="text-center mb-4">Preferências Alimentares</h2>
    <form id="perguntasForm">
      <div class="mb-3">
        <label class="form-label">Você gosta de frutas?</label>
        <select class="form-select" name="gostaFrutas" required>
          <option value="">Selecione...</option>
          <option value="Sim">Sim</option>
          <option value="Não">Não</option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Qual(is) fruta(s) não lhe agrada?</label>
        <input type="text" class="form-control" name="frutasNaoAgrada" placeholder="Ex: Mamão, Abacate...">
      </div>

      <div class="mb-3">
        <label class="form-label">Você gosta de verduras?</label>
        <select class="form-select" name="gostaVerduras" required>
          <option value="">Selecione...</option>
          <option value="Sim">Sim</option>
          <option value="Não">Não</option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Qual(is) verdura(s) não lhe agrada?</label>
        <input type="text" class="form-control" name="verdurasNaoAgrada" placeholder="Ex: Couve, Espinafre...">
      </div>

      <div class="mb-3">
        <label class="form-label">Você é alérgico a alguma coisa?</label>
        <input type="text" class="form-control" name="alergias" placeholder="Ex: Amendoim, lactose...">
      </div>

      <div class="text-center mt-4">
        <button type="submit" class="btn btn-success px-4">Enviar Respostas</button>
      </div>
    </form>

    <div id="respostaIA" class="mt-4 text-center" style="display: none;">
      <div class="alert alert-info">
        <strong>IA:</strong> Processando suas respostas... aguarde.
      </div>
    </div>

    <div class="text-center mt-3" id="botaoProximo" style="display: none;">
      <a href="/ReceitaSaudaveis" class="btn btn-primary px-4">Próximo</a>
    </div>
  </div>
</div>

  <script>
document.getElementById("perguntasForm").addEventListener("submit", async function(event) {
    event.preventDefault();

    const form = event.target;

    const gostaFrutas = form.gostaFrutas.value;
    const frutasNaoAgrada = form.frutasNaoAgrada.value.trim();

    const gostaVerduras = form.gostaVerduras.value;
    const verdurasNaoAgrada = form.verdurasNaoAgrada.value.trim();

    const alergias = form.alergias.value.trim();

    // ---- VALIDAÇÕES OBRIGATÓRIAS ----

    // 1. Se usuário NÃO gosta de frutas → tem que escrever quais
    if (gostaFrutas === "Não" && frutasNaoAgrada === "") {
        alert("Por favor, informe quais frutas você não gosta.");
        return;
    }

    // 2. Se usuário NÃO gosta de verduras → tem que escrever quais
    if (gostaVerduras === "Não" && verdurasNaoAgrada === "") {
        alert("Por favor, informe quais verduras você não gosta.");
        return;
    }

    // 3. Alergias pode ser vazio, mas se não for → precisa ter texto válido
    if (alergias.length > 0 && alergias.length < 2) {
        alert("Por favor, descreva melhor suas alergias.");
        return;
    }

    // ---- Envio ao servidor ----
    const formData = {
        gostaFrutas,
        frutasNaoAgrada,
        gostaVerduras,
        verdurasNaoAgrada,
        alergias
    };

    document.getElementById("respostaIA").style.display = "block";
    document.getElementById("respostaIA").innerHTML =
        `<div class='alert alert-info'>Enviando respostas para o servidor...</div>`;

    try {
        const response = await fetch("/api/perguntas", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(formData)
        });

        if (!response.ok) {
            throw new Error("Erro ao enviar dados");
        }

        const data = await response.json();
        document.getElementById("respostaIA").innerHTML =
            `<div class='alert alert-success'><strong>IA:</strong> ${data.mensagem || "Respostas recebidas!"}</div>`;
        document.getElementById("botaoProximo").style.display = "block";

    } catch (error) {
        document.getElementById("respostaIA").innerHTML =
            `<div class='alert alert-danger'>Erro ao processar suas respostas.</div>`;
        console.error(error);
    }
});
</script>
</body>
</html>
